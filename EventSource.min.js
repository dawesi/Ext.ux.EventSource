Ext.define("Ext.ux.EventSource",{alias:"widget.eventsource",mixins:{observable:"Ext.util.Observable"},requires:["Ext.util.TaskManager"],config:{url:""},CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3,constructor:function(a){var b=this;if(Ext.isEmpty(a))return Ext.Error.raise("URL for the EventSource is required!"),null;"string"==typeof a&&(a={url:a}),b.initConfig(a),b.mixins.observable.constructor.call(b,a),b.addEvents("open","error","close","message");try{b.init()}catch(c){return Ext.Error.raise(c),null}return b},isReady:function(){return this.getStatus()===this.OPEN?!0:!1},getStatus:function(){return this.es.readyState},close:function(){var a=this;return a.es.close(),a.fireEvent("close",a),a},init:function(){var a=this;if("undefined"==typeof EventSource||null===EventSource)throw"Ext.ux.EventSource: your browser does not support HTML5 EventSource.";a.es=new EventSource(a.getUrl()),a.es.onopen=function(){a.fireEvent("open",a);for(var b in a.events)a.attachEvent(b)},a.es.onerror=function(b){a.fireEvent("error",a,b)},a.es.onclose=function(){a.fireEvent("close",a)},a.es.onmessage=Ext.bind(a.receiveMessage,this)},receiveMessage:function(a,b){var c=this,d=Ext.JSON.decode(a.data,!0);Ext.isEmpty(d)&&(d=a.data),b=b||"message",c.fireEvent(b,c,d)},attachEvent:function(a){var b=this;b.hasListener(a)||b.es.addEventListener(a,function(c){b.receiveMessage(c,a)})},detachEvent:function(a){var b=this;b.hasListener(a)&&b.es.removeEventListener(a,function(c){b.receiveMessage(c,a)})},addListener:function(a){var b=this;if(!Ext.isEmpty(b.es))if("string"==typeof a)b.attachEvent(a);else for(var c in a)b.attachEvent(c);b.mixins.observable.addListener.apply(b,arguments)},removeListener:function(a){var b=this;if(!Ext.isEmpty(b.es))if("string"==typeof a)b.detachEvent(a);else for(var c in a)b.detachEvent(c);b.mixins.observable.removeListener.apply(b,arguments)}});